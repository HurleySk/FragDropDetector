{% extends "base.html" %}

{% block title %}Configuration - FragDropDetector{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/configuration.css">
{% endblock %}

{% block content %}
<div class="configuration-page hidden" id="configuration-content">
    <div class="page-header">
        <h1 class="page-title">Configuration</h1>
        <p class="page-subtitle">Configure monitoring settings and notification services</p>
    </div>

    <!-- Configuration Tabs -->
    <div class="config-tabs">
        <div class="tab-nav">
            <button class="tab-btn active" data-tab="reddit">Reddit API</button>
            <button class="tab-btn" data-tab="notifications">Notifications</button>
            <button class="tab-btn" data-tab="detection">Detection</button>
            <button class="tab-btn" data-tab="schedule">Schedule</button>
            <button class="tab-btn" data-tab="stock">Stock Monitoring</button>
        </div>

        <!-- Reddit Configuration -->
        <div class="tab-content active" id="reddit-tab">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Reddit API Settings</h2>
                    <p class="card-subtitle">Configure Reddit API access and monitoring parameters</p>
                </div>

                <form id="reddit-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Client ID</label>
                            <input type="text" id="reddit-client-id" placeholder="Your Reddit App Client ID" required>
                            <small>Get this from https://www.reddit.com/prefs/apps</small>
                        </div>

                        <div class="form-group">
                            <label>Client Secret</label>
                            <input type="password" id="reddit-client-secret" placeholder="Your Reddit App Client Secret" required>
                            <small>Keep this secret and secure</small>
                        </div>

                        <div class="form-group">
                            <label>Subreddit</label>
                            <input type="text" id="reddit-subreddit" value="MontagneParfums">
                            <small>Subreddit to monitor (without r/)</small>
                        </div>

                        <div class="form-group">
                            <label>Check Interval (seconds)</label>
                            <input type="number" id="reddit-interval" value="300" min="60" max="3600">
                            <small>How often to check for new posts (60-3600 seconds)</small>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn secondary" onclick="testRedditConnection()">Test Connection</button>
                        <button type="submit" class="btn primary">Save Reddit Settings</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Notifications Configuration -->
        <div class="tab-content" id="notifications-tab">
            <div class="grid grid-2">
                <!-- Pushover -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Pushover (iOS/Android)</h2>
                        <p class="card-subtitle">Real-time push notifications</p>
                    </div>

                    <div class="notification-config">
                        <div class="form-group">
                            <label>App Token</label>
                            <input type="text" id="pushover-app-token" placeholder="Your Pushover App Token">
                        </div>

                        <div class="form-group">
                            <label>User Key</label>
                            <input type="text" id="pushover-user-key" placeholder="Your Pushover User Key">
                        </div>

                        <div class="service-status" id="pushover-status">
                            <span class="status-indicator disabled"></span>
                            <span class="status-text">Not configured</span>
                        </div>
                    </div>
                </div>

                <!-- Discord -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Discord Webhook</h2>
                        <p class="card-subtitle">Discord server notifications</p>
                    </div>

                    <div class="notification-config">
                        <div class="form-group">
                            <label>Webhook URL</label>
                            <input type="text" id="discord-webhook" placeholder="https://discord.com/api/webhooks/...">
                        </div>

                        <div class="service-status" id="discord-status">
                            <span class="status-indicator disabled"></span>
                            <span class="status-text">Not configured</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="form-actions">
                    <button type="button" class="btn secondary" onclick="testAllNotifications()">Test All Services</button>
                    <button type="button" class="btn primary" onclick="saveNotificationConfig()">Save Notification Settings</button>
                </div>
            </div>
        </div>

        <!-- Detection Configuration -->
        <div class="tab-content" id="detection-tab">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Drop Detection Settings</h2>
                    <p class="card-subtitle">Configure keywords and detection parameters</p>
                </div>

                <form id="detection-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Primary Keywords</label>
                            <textarea id="primary-keywords" rows="6" placeholder="Enter keywords, one per line">drop
dropped
release
available
launch
restock
in stock</textarea>
                            <small>High-priority keywords that strongly indicate drops</small>
                        </div>

                        <div class="form-group">
                            <label>Secondary Keywords</label>
                            <textarea id="secondary-keywords" rows="6" placeholder="Enter keywords, one per line">limited
exclusive
sale
batch
decant
split</textarea>
                            <small>Supporting keywords that provide additional context</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Confidence Threshold</label>
                        <div class="range-input">
                            <input type="range" id="confidence-threshold" min="0" max="1" step="0.1" value="0.4">
                            <span class="range-value" id="confidence-value">0.4</span>
                        </div>
                        <small>Minimum confidence score required to trigger notifications (0.0 - 1.0)</small>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn primary">Save Detection Settings</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Schedule Configuration -->
        <div class="tab-content" id="schedule-tab">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Drop Window Schedule</h2>
                    <p class="card-subtitle">Configure when to actively monitor for drops</p>
                </div>

                <form id="window-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Window Checking</label>
                            <select id="window-enabled">
                                <option value="true">Enabled (Monitor during specific times)</option>
                                <option value="false">Disabled (Monitor 24/7)</option>
                            </select>
                            <small>Enable to save resources by monitoring only during likely drop times</small>
                        </div>

                        <div class="form-group">
                            <label>Timezone</label>
                            <select id="window-timezone">
                                <option value="America/New_York">Eastern Time (ET)</option>
                                <option value="America/Chicago">Central Time (CT)</option>
                                <option value="America/Denver">Mountain Time (MT)</option>
                                <option value="America/Los_Angeles">Pacific Time (PT)</option>
                                <option value="UTC">UTC</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Active Days</label>
                        <div class="days-selector">
                            <label class="day-checkbox"><input type="checkbox" id="day-0" value="0"> Monday</label>
                            <label class="day-checkbox"><input type="checkbox" id="day-1" value="1"> Tuesday</label>
                            <label class="day-checkbox"><input type="checkbox" id="day-2" value="2"> Wednesday</label>
                            <label class="day-checkbox"><input type="checkbox" id="day-3" value="3"> Thursday</label>
                            <label class="day-checkbox"><input type="checkbox" id="day-4" value="4" checked> Friday</label>
                            <label class="day-checkbox"><input type="checkbox" id="day-5" value="5"> Saturday</label>
                            <label class="day-checkbox"><input type="checkbox" id="day-6" value="6"> Sunday</label>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>Start Time</label>
                            <input type="time" id="window-start-time" value="12:00">
                        </div>

                        <div class="form-group">
                            <label>End Time</label>
                            <input type="time" id="window-end-time" value="17:00">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn primary">Save Schedule Settings</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Stock Monitoring Configuration -->
        <div class="tab-content" id="stock-tab">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Stock Monitoring</h2>
                    <p class="card-subtitle">Configure website inventory tracking and notifications</p>
                </div>

                <form id="stock-form">
                    <div class="form-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="stock-enabled">
                            <span class="toggle-slider"></span>
                            Enable Stock Monitoring
                        </label>
                        <small>Monitor Montagne Parfums website for inventory changes</small>
                    </div>

                    <div class="notification-types">
                        <h3>Notification Types</h3>

                        <label class="checkbox-option">
                            <input type="checkbox" id="notify-new-products" checked>
                            <span class="checkbox-custom"></span>
                            <div class="option-info">
                                <div class="option-title">New Products</div>
                                <div class="option-description">Notify when new fragrances are added</div>
                            </div>
                        </label>

                        <label class="checkbox-option">
                            <input type="checkbox" id="notify-restocked" checked>
                            <span class="checkbox-custom"></span>
                            <div class="option-info">
                                <div class="option-title">Restocked Items</div>
                                <div class="option-description">Notify when out-of-stock items become available</div>
                            </div>
                        </label>

                        <label class="checkbox-option">
                            <input type="checkbox" id="notify-price-changes">
                            <span class="checkbox-custom"></span>
                            <div class="option-info">
                                <div class="option-title">Price Changes</div>
                                <div class="option-description">Notify when prices increase or decrease</div>
                            </div>
                        </label>

                        <label class="checkbox-option">
                            <input type="checkbox" id="notify-out-of-stock">
                            <span class="checkbox-custom"></span>
                            <div class="option-info">
                                <div class="option-title">Out of Stock</div>
                                <div class="option-description">Notify when items go out of stock</div>
                            </div>
                        </label>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn primary">Save Stock Monitoring Settings</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="/static/js/configuration.js"></script>
{% endblock %}